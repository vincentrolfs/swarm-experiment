(this.webpackJsonpswarm=this.webpackJsonpswarm||[]).push([[0],{116:function(t,e,a){t.exports=a(287)},121:function(t,e,a){},122:function(t,e,a){},285:function(t,e,a){},286:function(t,e,a){},287:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),i=a(40),o=a.n(i),l=(a(121),a(122),a(44)),s=a(41),u=a(42),c=function(){function t(e,a){if(Object(s.a)(this,t),void 0===e||void 0===a){this.x=Math.random()-.5,this.y=Math.random()-.5;var n=d*Math.random()/this.magnitude();this.x*=n,this.x+=v.x,this.y*=n,this.y+=v.y}else this.x=e,this.y=a}return Object(u.a)(t,[{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"subtract",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"distance",value:function(t){return this.subtract(t).magnitude()}},{key:"multiply",value:function(e){return new t(this.x*e,this.y*e)}},{key:"divide",value:function(t){return this.multiply(1/t)}},{key:"moveUniform",value:function(t){t=t.divide(t.magnitude());var e=this.add(t);if(e.distance(v)<=d)return e;var a=h(v,d,this,1),n=Object(l.a)(a,2),r=n[0],i=n[1];return e.distance(r)<=e.distance(i)?r:i}}]),t}(),h=function(t,e,a,n){var r=[t.x,t.y,a.x,a.y],i=r[0],o=r[1],l=r[2],s=r[3],u=i-l,h=o-s,d=Math.sqrt(u*u+h*h);if(!(Math.abs(e-n)<=d&&d<=e+n))throw new Error("No intersection: "+[i,o,e,l,s,n]);var v=d*d,p=v*v,m=(e*e-n*n)/(2*v),f=e*e-n*n,g=Math.sqrt(2*(e*e+n*n)/v-f*f/p-1),E=(i+l)/2+m*(l-i),b=g*(s-o)/2,y=E-b,O=(o+s)/2+m*(s-o),w=g*(i-l)/2,_=O-w;return[new c(E+b,O+w),new c(y,_)]},d=350,v=new c(375,375),p=a(13),m=a(15),f="ALL",g="ONLY_STATIONARY",E="NEVER",b=function(t,e){return{type:"SET_AGENT_BEHAVIOUR",agent_id:t,behaviour:e}},y={behaviourUpdateRule:E},O=a(16),w=a(115),_=a(110),k=a.n(_),M=a(46),A=a.n(M),x=1,j=k()({count:50}).map((function(t){return t.hex()})),C=function(){for(var t={},e=0;e<3;e++)t=Object(p.a)({},t,{},N());var a=Object.keys(t);return a.forEach((function(e){t[e].partner_id=function(t,e){var a;do{a=e[parseInt(Math.random()*e.length)]}while(a===t);return a}(e,a)})),t}();function N(){var t=(x++).toString(),e=I(),a=j[t%j.length];return Object(O.a)({},t,{id:t,partner_id:null,behaviour:e,color:a})}function I(){return 4*Math.random()*d-2*d}function T(t,e){var a=Object(p.a)({},t);for(var n in delete a[e],a)a.hasOwnProperty(n)&&a[n].partner_id===e&&(a[n].partner_id=null);return a}var R,U=Object(m.c)({settings:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"SET_BEHAVIOUR_UPDATE_RULE":return Object(p.a)({},t,{behaviourUpdateRule:e.rule});default:return t}},agents:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"ADD_AGENT":return Object(p.a)({},t,{},N());case"SET_AGENT_BEHAVIOUR":return A()(t,Object(O.a)({},e.agent_id,{behaviour:{$set:e.behaviour}}));case"RANDOMIZE_AGENT_BEHAVIOUR":return A()(t,Object(O.a)({},e.agent_id,{behaviour:{$set:I()}}));case"SET_PARTNER_ID":return A()(t,Object(O.a)({},e.agent_id,{partner_id:{$set:e.partner_id||null}}));case"REMOVE_AGENT":return T(t,e.agent_id);default:return t}}}),P=a(112),S=a.n(P),D=a(67),L=Object(D.load)();(R=L.agents)&&(x=1+Math.max.apply(Math,Object(w.a)(Object.values(R).map((function(t){return parseInt(t.id)}))))||1);var G=Object(m.d)(U,L,Object(m.a)(S.a,Object(D.save)())),B=function(){function t(e){Object(s.a)(this,t),this.canvas=e,this.ctx=e.getContext("2d"),this.agents={},this.positions={},this.movementChangeTimestamps={},this.hasMovedLastUpdate={},this.loopCounter=1,this.loopInterval=null,this.runLoop()}return Object(u.a)(t,[{key:"runLoop",value:function(){var t=this;this.loadAgents(),this.draw(),this.loopInterval=setInterval((function(){try{t.draw(),t.loadAgents(),t.updatePositions(),t.loopCounter++}catch(e){throw clearInterval(t.loopInterval),e}}),5)}},{key:"draw",value:function(){for(var t in this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawArena(),this.agents)this.drawAgent(t)}},{key:"drawArena",value:function(){this.ctx.beginPath(),this.ctx.arc(v.x,v.y,d,0,2*Math.PI,!1),this.ctx.lineWidth=8;var t=this.ctx.createRadialGradient(v.x,v.y,d,v.x,v.y,d+50);t.addColorStop(0,"black"),t.addColorStop(.2,"white"),this.ctx.strokeStyle=t,this.ctx.stroke()}},{key:"drawAgent",value:function(t){var e=this.ctx,a=this.positions[t],n=a.x,r=a.y,i=this.agents[t].color,o=this.agents[t].partner_id,l=o&&this.agents[o].color,s=1===Math.sign(this.agents[t].behaviour);e.beginPath(),e.arc(n,r,20,0,2*Math.PI,!1),e.fillStyle=i,e.fill(),o&&(e.font="15px serif",e.fillText(s?"\u2764\ufe0f":"\ud83d\udd25",n+10,r-10),e.beginPath(),e.arc(n+20/3,r+20/3,20/3,0,2*Math.PI,!1),e.fillStyle=l,e.fill())}},{key:"loadAgents",value:function(){for(var t in this.agents=G.getState().agents,this.agents)this.positions.hasOwnProperty(t)||(this.positions[t]=new c,this.movementChangeTimestamps[t]=0,this.hasMovedLastUpdate[t]=!1);for(var e in this.positions)this.agents.hasOwnProperty(e)||(delete this.positions[e],delete this.movementChangeTimestamps[e],delete this.hasMovedLastUpdate[e])}},{key:"updatePositions",value:function(){var t=this.positions,e=this.agents,a=Object(p.a)({},t);for(var n in e){var r=e[n];if(r.partner_id){var i=t[n],o=t[r.partner_id],s=r.behaviour,u=this.findNewPosition(i,o,s),c=Object(l.a)(u,2),h=c[0],d=c[1];a[n]=h,this.updateHasMovedLastUpdate(n,d),this.updateBehaviour(n,d)}}this.positions=a}},{key:"updateHasMovedLastUpdate",value:function(t,e){this.hasMovedLastUpdate[t]!==e&&(this.movementChangeTimestamps[t]=this.loopCounter,this.hasMovedLastUpdate[t]=e)}},{key:"updateBehaviour",value:function(t,e){var a=G.getState().settings.behaviourUpdateRule;if(a!==E&&(a!==g||!e)){var n=this.loopCounter-this.movementChangeTimestamps[t],r=1250,i=(Math.exp(n/r)-Math.exp(1/r))/(Math.exp(8)-Math.exp(1/r));if(!(Math.random()>i))G.dispatch({type:"RANDOMIZE_AGENT_BEHAVIOUR",agent_id:t})}}},{key:"findNewPosition",value:function(t,e,a){var n=this.findDirectionMultiplier(t,e,a);if(0===n)return[t,!1];var r=e.subtract(t).multiply(n);return[t.moveUniform(r),!0]}},{key:"findDirectionMultiplier",value:function(t,e,a){var n=t.distance(e),r=Math.sign(a);return r*n>a?r:0}}]),t}(),V=a(21),H=a(43),W=a(9),$=function(){var t=Object(W.b)(),e=Object(W.c)((function(t){return t.settings})).behaviourUpdateRule,a=Object(n.useCallback)((function(e){t({type:"SET_BEHAVIOUR_UPDATE_RULE",rule:e.target.value})}),[t]);return r.a.createElement(H.a,{variant:"dark"},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"Automatically update agent behaviour"),r.a.createElement("td",null,r.a.createElement(V.a.Control,{as:"select",defaultValue:e,onChange:a},r.a.createElement("option",{value:f},"Automatically update all agents"),r.a.createElement("option",{value:g},"Automatically update only stationary agents"),r.a.createElement("option",{value:E},"Never update behaviour of agents"))))))},q=a(114),F=(a(285),a(45)),J=a(20),Y=function(t){var e=t.allAgents,a=t.agent,i=Object(W.b)(),o=Object(n.useCallback)((function(t){return i((e=a.id,n=t.target.value,{type:"SET_PARTNER_ID",agent_id:e,partner_id:n}));var e,n}),[i,a.id]),l=Object(n.useCallback)((function(t){return i(b(a.id,Math.abs(a.behaviour)*t.target.value))}),[i,a.id,a.behaviour]),s=Object(n.useCallback)((function(t){var e=parseFloat(t.target.value);isNaN(e)||e<=0||i(b(a.id,Math.sign(a.behaviour)*e))}),[i,a.id,a.behaviour]),u=Object(n.useCallback)((function(t){return i({type:"REMOVE_AGENT",agent_id:a.id})}),[i,a.id]);return r.a.createElement("tr",{key:a.id},r.a.createElement("td",null,"#",a.id," ",r.a.createElement("span",{className:"colorIndictaor",style:{background:a.color}})),r.a.createElement("td",null,r.a.createElement(V.a.Control,{as:"select",defaultValue:a.partner_id||"",onChange:o},r.a.createElement("option",{value:"",key:null,className:"emptyOption"},"No partner"),e.map((function(t){return t.id===a.id?null:r.a.createElement("option",{value:t.id,key:t.id},"#",t.id)})))),r.a.createElement("td",null,r.a.createElement(V.a.Control,{value:Math.abs(a.behaviour),onChange:s})),r.a.createElement("td",null,r.a.createElement(V.a.Control,{as:"select",value:Math.sign(a.behaviour),onChange:l},r.a.createElement("option",{value:1},"Get close"),r.a.createElement("option",{value:-1},"Stay away"))),r.a.createElement("td",null,r.a.createElement(F.a,{variant:"light",onClick:u},r.a.createElement(J.c,{icon:J.b,className:"icon"}))))},Z=(a(286),function(){var t=z(),e=Object(W.b)(),a=Object(n.useCallback)((function(t){return e({type:"ADD_AGENT"})}),[e]);return r.a.createElement(H.a,{variant:"dark"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Agent ID"),r.a.createElement("th",null,"Partner ID"),r.a.createElement("th",null,"Goal distance"),r.a.createElement("th",null,"Goal behaviour"),r.a.createElement("th",null,"\xa0"))),r.a.createElement("tbody",null,t.map((function(e){return r.a.createElement(Y,{agent:e,allAgents:t,key:e.id})})),r.a.createElement("tr",null,r.a.createElement("td",{colSpan:5,className:"buttonCell"},r.a.createElement(F.a,{variant:"light",onClick:a},r.a.createElement(J.c,{icon:J.a,className:"icon"})," Add agent")))))}),z=function(){var t=Object(W.c)((function(t){return t.agents}));return Object(q.sortBy)(Object.values(t),(function(t){return parseInt(t.id)}))};var K=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"canvasWrapper"},r.a.createElement("canvas",{width:750,height:750,ref:function(t){return new B(t)}})),r.a.createElement("div",{className:"stuffWrapper"},r.a.createElement(Z,null),r.a.createElement($,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(W.a,{store:G},r.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[116,1,2]]]);
//# sourceMappingURL=main.dd24f9b1.chunk.js.map